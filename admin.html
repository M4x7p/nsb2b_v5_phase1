<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NSB2B • Admin</title>

  <!-- ฟอนต์ Prompt ครอบทั้งหน้า -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- สไตล์หลัก -->
  <link rel="stylesheet" href="./styles.css?v=2025-10-27-2" />

  <!-- Theme/Font override ให้ปุ่มและอินพุตก็ใช้ Prompt -->
  <style>
    :root {
      --brand:#ff6b00;
      --brand-600:#ff7f26;
      --border:#eceff3;
      --muted:#6b7480;
    }
    html, body, button, input, select, textarea {
      font-family:"Prompt", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, Helvetica, Arial !important;
      letter-spacing:.1px;
    }
    body.theme-light{ background:#fff; color:#1d2430; }
    .header{ background:#fff; border:1px solid var(--border); }
    .logo{ height:28px; width:auto; border-radius:6px; object-fit:contain; }
    .title{ font-weight:700; }
    .card{ background:#fff; }
    .hint{ color:var(--muted); font-size:.9rem; }
    .grid-2{
      display:grid; gap:14px;
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    @media (max-width:720px){ .grid-2{ grid-template-columns:1fr; } }

    .btn{ font-weight:600; border-radius:10px; }
    .btn-primary{ background:var(--brand); border-color:var(--brand); }
    .btn-primary:hover{ background:var(--brand-600); border-color:var(--brand-600); }
    .btn-outline{ border-color:var(--brand); color:var(--brand); }
    .btn-outline:hover{ background:#fff3ea; }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .result-box code{ background:#fff6ef; border:1px dashed var(--brand-600); padding:6px 8px; border-radius:8px; display:inline-block; }
    .result-row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  </style>
</head>
<body class="theme-light">
  <div class="container" id="adminPage">
    <!-- Header -->
    <header class="header">
      <div class="brand">
        <img src="./dohome_logo.jpg?v=3" alt="DoHome" class="logo" />
        <div class="title">NSB2B — Admin</div>
      </div>
      <div class="header-actions">
        <a class="btn btn-outline" href="./index.html">กลับหน้าใช้งาน</a>
      </div>
    </header>

    <!-- การออกโค้ดเชิญ -->
    <section class="card">
      <h2 class="card-title">ออกโค้ดเชิญ (Invite)</h2>
      <p class="hint">กรอกข้อมูลด้านล่าง แล้วกด “สร้าง Invite” ระบบจะบันทึกลง Excel/SharePoint ตาม Flow ที่ตั้งค่าไว้</p>

      <div class="grid-2 mt-3">
        <div class="form-field">
          <label for="adminToken">Admin Token</label>
          <input id="adminToken" type="password" class="input" placeholder="เฉพาะ Admin" autocomplete="off" />
          <div class="hint">จะถูกส่งใน Header: <span class="mono">X-Admin-Token</span></div>
        </div>

        <div class="form-field">
          <label for="team">ทีม / Team</label>
          <select id="team" class="input">
            <option value="A">ทีม A</option>
            <option value="B">ทีม B</option>
            <option value="C">ทีม C</option>
            <option value="D">ทีม D</option>
          </select>
        </div>

        <div class="form-field">
          <label for="branch">สาขา / Branch (ทางเลือก)</label>
          <input id="branch" type="text" class="input" placeholder="เช่น NS" />
        </div>

        <div class="form-field">
          <label for="prefix">Prefix โค้ด</label>
          <input id="prefix" type="text" class="input" placeholder="เช่น INV-" />
          <div class="hint">แนะนำให้ตั้งค่าเริ่มต้นแล้วระบบจะจำไว้ (เช่น <span class="mono">INV-</span>)</div>
        </div>

        <div class="form-field">
          <label for="baseWebUrl">Base Web URL</label>
          <input id="baseWebUrl" type="url" class="input" placeholder="เช่น https://m4x7p.github.io/nsb2b_v5_phase1/" />
          <div class="hint">ใช้สร้างลิงก์เชิญอัตโนมัติ (แนบ <span class="mono">?invite=CODE</span>)</div>
        </div>

        <div class="form-field">
          <label for="maxUses">จำนวนครั้งที่ใช้ได้</label>
          <input id="maxUses" type="number" class="input" min="1" step="1" value="1" />
        </div>

        <div class="form-field">
          <label for="expiresInDays">อายุโค้ด (วัน)</label>
          <input id="expiresInDays" type="number" class="input" min="1" step="1" value="14" />
        </div>
      </div>

      <div class="mt-4" style="display:flex;gap:10px;flex-wrap:wrap">
        <button id="btnCreateInvite" class="btn btn-primary">สร้าง Invite</button>
        <!-- แก้จากลิงก์เปิดไฟล์ เป็น “คัดลอกลิงก์” ตามที่สั่ง -->
        <button id="btnCopyTop" class="btn btn-outline" type="button">คัดลอกลิงก์</button>
      </div>
    </section>

    <!-- ผลลัพธ์การสร้างโค้ด -->
    <section id="resultBox" class="card hidden result-box">
      <h2 class="card-title">ผลลัพธ์</h2>

      <div class="form-field">
        <label>Invite Code</label>
        <div><code id="resultCode" class="mono">-</code></div>
      </div>

      <div id="inviteUrl" class="form-field hidden">
        <label>Invite URL</label>
        <div class="result-row">
          <a id="resultLink" href="#" target="_blank" rel="noopener" class="mono">-</a>
          <button id="btnCopyLink" class="btn btn-outline" type="button">คัดลอกลิงก์</button>
          <span id="copyStatus" class="hint" aria-live="polite"></span>
        </div>
      </div>
    </section>
  </div>

  <!-- สคริปต์หลักของหน้า Admin -->
  <script type="module" src="./app.js?v=2025-10-27-2"></script>

  <!-- สคริปต์เล็ก ๆ สำหรับปุ่มคัดลอก (ทั้งปุ่มบนและในผลลัพธ์) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const linkEl   = document.getElementById('resultLink');
      const btnCopy1 = document.getElementById('btnCopyLink'); // ปุ่มในผลลัพธ์
      const btnCopy2 = document.getElementById('btnCopyTop');  // ปุ่มด้านบน
      const statusEl = document.getElementById('copyStatus');

      async function copyInviteLink() {
        try {
          const url = linkEl?.href || '';
          if (!url || url === '#') {
            // ยังไม่มีลิงก์ให้คัดลอก
            toast('ยังไม่มีลิงก์ให้คัดลอก');
            return;
          }
          await navigator.clipboard.writeText(url);
          toast('คัดลอกลิงก์แล้ว');
        } catch {
          toast('คัดลอกไม่สำเร็จ');
        }
      }

      function toast(msg) {
        if (statusEl) {
          statusEl.textContent = msg || '';
          clearTimeout(toast._t);
          toast._t = setTimeout(() => statusEl.textContent = '', 2000);
        } else {
          // กันกรณีไม่มี statusEl ก็ยังแจ้งเตือนด้วย alert ได้
          if (msg) alert(msg);
        }
      }

      btnCopy1?.addEventListener('click', copyInviteLink);
      btnCopy2?.addEventListener('click', copyInviteLink);
    });
  </script>
</body>
</html>
